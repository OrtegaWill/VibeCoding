<div class="kanban-container">
  <!-- Header del Kanban -->
  <div class="kanban-header">
    <div class="header-left">
      <h2>Tablero Kanban</h2>
      <div class="sprint-selector" *ngIf="sprints.length > 0">
        <label for="sprint-select">Sprint:</label>
        <select id="sprint-select" (change)="onSprintChange($event)" [value]="selectedSprint?.id || ''">
          <option value="">Sin Sprint</option>
          <option *ngFor="let sprint of sprints" [value]="sprint.id">
            {{sprint.name}} ({{sprint.status}})
          </option>
        </select>
      </div>
    </div>
    <div class="header-right">
      <button class="btn btn-primary" (click)="showCreateTaskModal = true">
        <i class="icon-plus"></i> Nueva Tarea
      </button>
    </div>
  </div>

  <!-- Tablero Kanban -->
  <div class="kanban-board">
    <div 
      class="kanban-column" 
      *ngFor="let column of kanbanColumns"
      (dragover)="onDragOver($event)"
      (drop)="onDrop($event, column.status)"
    >
      <!-- Header de la columna -->
      <div class="column-header" [style.border-top-color]="column.color">
        <h3>{{column.title}}</h3>
        <span class="task-count">{{getTasksForStatus(column.status).length}}</span>
      </div>

      <!-- Tareas en la columna -->
      <div class="column-tasks">
        <div 
          class="task-card"
          *ngFor="let task of getTasksForStatus(column.status)"
          draggable="true"
          (dragstart)="onDragStart($event, task)"
          [class.dragging]="draggedTask === task"
        >
          <!-- Priority indicator -->
          <div class="task-priority" [ngClass]="getPriorityClass(task.priority)"></div>
          
          <!-- Task content -->
          <div class="task-content">
            <h4 class="task-title">{{task.title}}</h4>
            <p class="task-description" *ngIf="task.description">{{task.description}}</p>
            
            <!-- Task metadata -->
            <div class="task-metadata">
              <span class="task-priority-text">{{task.priority}}</span>
              <span class="task-date">{{task.createdAt | date:'dd/MM/yyyy'}}</span>
              <span class="task-assignee" *ngIf="task.assignedTo">{{task.assignedTo}}</span>
            </div>
          </div>

          <!-- Task actions -->
          <div class="task-actions">
            <button class="btn-action" (click)="editTask(task)" title="Editar">
              ‚úèÔ∏è
            </button>
            <button class="btn-action" (click)="deleteTask(task)" title="Eliminar">
              üóëÔ∏è
            </button>
          </div>
        </div>

        <!-- Empty state -->
        <div class="empty-column" *ngIf="getTasksForStatus(column.status).length === 0">
          <p>No hay tareas en esta columna</p>
          <small>Arrastra tareas aqu√≠ para cambiar su estado</small>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal para crear tarea -->
  <div class="modal-overlay" *ngIf="showCreateTaskModal" (click)="showCreateTaskModal = false">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Nueva Tarea</h3>
        <button class="btn-close" (click)="showCreateTaskModal = false">&times;</button>
      </div>
      
      <form class="modal-body" (ngSubmit)="createTask()" #taskForm="ngForm">
        <div class="form-group">
          <label for="task-title">T√≠tulo</label>
          <input 
            type="text" 
            id="task-title"
            class="form-input" 
            [(ngModel)]="newTask.title" 
            name="title" 
            required
            placeholder="Ingresa el t√≠tulo de la tarea"
          >
        </div>

        <div class="form-group">
          <label for="task-description">Descripci√≥n</label>
          <textarea 
            id="task-description"
            class="form-textarea" 
            [(ngModel)]="newTask.description" 
            name="description" 
            rows="3"
            placeholder="Describe la tarea (opcional)"
          ></textarea>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="task-priority">Prioridad</label>
            <select id="task-priority" class="form-select" [(ngModel)]="newTask.priority" name="priority">
              <option value="Low">Baja</option>
              <option value="Medium">Media</option>
              <option value="High">Alta</option>
              <option value="Critical">Cr√≠tica</option>
            </select>
          </div>

          <div class="form-group">
            <label for="task-status">Estado</label>
            <select id="task-status" class="form-select" [(ngModel)]="newTask.status" name="status">
              <option value="Backlog">Backlog</option>
              <option value="Todo">Por Hacer</option>
              <option value="InProgress">En Progreso</option>
              <option value="Review">En Revisi√≥n</option>
              <option value="Done">Completado</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label for="task-assignee">Asignado a</label>
          <input 
            type="text" 
            id="task-assignee"
            class="form-input" 
            [(ngModel)]="newTask.assignedTo" 
            name="assignedTo"
            placeholder="Nombre de la persona asignada"
          >
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="showCreateTaskModal = false">
            Cancelar
          </button>
          <button type="submit" class="btn btn-primary" [disabled]="!taskForm.form.valid">
            Crear Tarea
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
