<div class="backlog-container">
  <div class="page-header">
    <h1 class="page-title">Backlog</h1>
    <div class="header-actions">
      <button class="btn btn-primary" (click)="showCreateModal = true">
        + Nueva Tarea
      </button>
    </div>
  </div>

  <p class="subtitle">Gestiona las tareas que aún no están asignadas a un sprint</p>

  <!-- Filtros y controles -->
  <div class="controls-panel">
    <div class="search-filter">
      <input 
        type="text" 
        placeholder="Buscar tareas..." 
        [(ngModel)]="searchTerm" 
        (input)="onSearchChange()"
        class="search-input">
    </div>

    <div class="filter-row">
      <select [(ngModel)]="currentFilter" (change)="onFilterChange()" class="filter-select">
        <option value="all">Todas las tareas</option>
        <option value="high-priority">Alta prioridad</option>
        <option value="unassigned">Sin asignar</option>
        <option value="assigned">Asignadas</option>
      </select>

      <select [(ngModel)]="selectedPriority" (change)="onFilterChange()" class="filter-select">
        <option value="">Todas las prioridades</option>
        <option [value]="TaskPriority.Critical">🔴 Crítica</option>
        <option [value]="TaskPriority.High">🟠 Alta</option>
        <option [value]="TaskPriority.Medium">🟡 Media</option>
        <option [value]="TaskPriority.Low">🟢 Baja</option>
      </select>

      <select [(ngModel)]="selectedAssignee" (change)="onFilterChange()" class="filter-select">
        <option value="">Todos los asignados</option>
        <option *ngFor="let assignee of getUniqueAssignees()" [value]="assignee">
          {{assignee}}
        </option>
      </select>

      <select [(ngModel)]="currentSortBy" (change)="onSortChange()" class="filter-select">
        <option value="priority">Ordenar por prioridad</option>
        <option value="title">Ordenar por título</option>
        <option value="created">Ordenar por fecha de creación</option>
        <option value="updated">Ordenar por última actualización</option>
      </select>

      <button class="btn btn-secondary" (click)="clearFilters()">
        Limpiar filtros
      </button>
    </div>
  </div>

  <!-- Lista de tareas -->
  <div class="tasks-container">
    <div class="tasks-header">
      <div class="task-count">
        {{filteredTasks.length}} tarea(s) encontrada(s)
      </div>
    </div>

    <div class="tasks-list">
      <div 
        *ngFor="let task of filteredTasks; trackBy: trackByTaskId" 
        class="task-card">
        
        <div class="task-header">
          <div class="task-meta">
            <span class="task-priority" [class]="getPriorityClass(task.priority)">
              {{getPriorityIcon(task.priority)}} {{getPriorityLabel(task.priority)}}
            </span>
            <span class="task-id" *ngIf="task.id">#{{task.id}}</span>
          </div>
          
          <div class="task-actions">
            <button 
              class="btn-icon" 
              (click)="startEditingTask(task)"
              title="Editar">
              ✏️
            </button>
            <button 
              class="btn-icon" 
              (click)="deleteTask(task)"
              title="Eliminar">
              🗑️
            </button>
          </div>
        </div>

        <div class="task-content">
          <h3 class="task-title">{{task.title}}</h3>
          <p class="task-description" *ngIf="task.description">{{task.description}}</p>
          
          <div class="task-details">
            <div class="task-assignee" *ngIf="task.assignedTo">
              <strong>Asignado a:</strong> {{task.assignedTo}}
            </div>
            <div class="task-dates">
              <div *ngIf="task.createdAt">
                <strong>Creado:</strong> {{task.createdAt | date:'short'}}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Estado vacío -->
    <div *ngIf="filteredTasks.length === 0" class="empty-state">
      <div class="empty-icon">📋</div>
      <h3>No se encontraron tareas</h3>
      <p>¡Comienza creando tu primera tarea de backlog!</p>
      <button class="btn btn-primary" (click)="showCreateModal = true">
        + Nueva Tarea
      </button>
    </div>
  </div>
</div>

<!-- Modal para crear tarea -->
<div class="modal-overlay" *ngIf="showCreateModal" (click)="showCreateModal = false">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Nueva Tarea de Backlog</h2>
      <button class="btn-close" (click)="showCreateModal = false">×</button>
    </div>
    
    <form (ngSubmit)="createTask()" class="modal-form">
      <div class="form-group">
        <label for="taskTitle">Título *</label>
        <input 
          id="taskTitle"
          type="text" 
          [(ngModel)]="newTask.title" 
          name="title"
          class="form-input"
          placeholder="Ingresa el título de la tarea"
          required>
      </div>
      
      <div class="form-group">
        <label for="taskDescription">Descripción</label>
        <textarea 
          id="taskDescription"
          [(ngModel)]="newTask.description" 
          name="description"
          class="form-input form-textarea"
          rows="4"
          placeholder="Describe la tarea en detalle">
        </textarea>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label for="taskPriority">Prioridad</label>
          <select 
            id="taskPriority"
            [(ngModel)]="newTask.priority" 
            name="priority"
            class="form-select">
            <option [value]="TaskPriority.Critical">🔴 Crítica</option>
            <option [value]="TaskPriority.High">🟠 Alta</option>
            <option [value]="TaskPriority.Medium">🟡 Media</option>
            <option [value]="TaskPriority.Low">🟢 Baja</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="taskAssignee">Asignado a</label>
          <input 
            id="taskAssignee"
            type="text" 
            [(ngModel)]="newTask.assignedTo" 
            name="assignedTo"
            class="form-input"
            placeholder="Nombre del usuario">
        </div>
      </div>
      
      <div class="modal-actions">
        <button type="submit" class="btn btn-primary">Crear Tarea</button>
        <button type="button" class="btn btn-secondary" (click)="showCreateModal = false">
          Cancelar
        </button>
      </div>
    </form>
  </div>
</div>
